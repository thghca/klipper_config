[gcode_macro R1]
gcode:
	{% set z_ask = params.Z|default(3)|float %}
	{% set speed = params.F|default(1000)|float %}
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	
	{% if act_z + z_ask > max_z %}
		{% set z_raised = max_z %}
	{% else %}
		{% set z_raised = act_z + z_ask%}
	{% endif %}
	
	SAVE_GCODE_STATE NAME=raise_z_state
	
	G90	;absolute positionning
	G1 Z{z_raised} F{speed}
	
	RESTORE_GCODE_STATE NAME=raise_z_state