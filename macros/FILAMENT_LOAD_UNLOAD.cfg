[gcode_macro FILAMENT_UNLOAD]
variable_is_unloaded: 0
gcode:
	{% if not printer.extruder.can_extrude %}
		RESPOND MSG="Prevented cold unload!"
	{% elif printer.idle_timeout.state == "Printing" %}
		RESPOND MSG="Unload cannot be used while printing!"
	{% else %}
		SAVE_GCODE_STATE NAME=FILAMENT_UNLOAD_state		
		M83				#relative e positioning 
		G0 E{params.E|default(-120)|int} F400	#unload
		SET_GCODE_VARIABLE MACRO=FILAMENT_UNLOAD VARIABLE=is_unloaded VALUE=1
		RESTORE_GCODE_STATE NAME=FILAMENT_UNLOAD_state
	{% endif %}


[gcode_macro FILAMENT_LOAD]
gcode:
	{% if printer["gcode_macro FILAMENT_UNLOAD"].is_unloaded == 0 %}
		RESPOND MSG="Unload first!"
	{% elif not printer.extruder.can_extrude %}
		RESPOND MSG="Prevented cold load!"
	{% elif printer.idle_timeout.state == "Printing" %}
		RESPOND MSG="Load cannot be used while printing!"
	{% else %}
		SAVE_GCODE_STATE NAME=FILAMENT_LOAD_state		
		M83				#relative e positioning 
		G0 E{params.E|default(120)|int} F400	#load
		SET_GCODE_VARIABLE MACRO=FILAMENT_UNLOAD VARIABLE=is_unloaded VALUE=1
		RESTORE_GCODE_STATE NAME=FILAMENT_LOAD_state
	{% endif %}
